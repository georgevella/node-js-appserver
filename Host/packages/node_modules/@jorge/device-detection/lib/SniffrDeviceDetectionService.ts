import { Injectable } from "container-ioc";
import { IDeviceDetectionService, IDeviceInformation } from "./interfaces"
import { DeviceInformation } from "./DeviceInformation"
import * as sniffr from "sniffr";

@Injectable()
export class SniffrDeviceDetectionService implements IDeviceDetectionService {
  parseUserAgent(userAgent: string): IDeviceInformation {
    var s = new sniffr();
    s.sniff(userAgent);

    var isMobile: boolean;

    switch (s.os.name)
    {
      case "android":
      case "firefoxos":
      case "windows.phone":
      case "windows.mobile":
      case "blackberryos":
      case "ios":
        isMobile = true;
        break;
      default:
        isMobile = false;
        break;
    }

    var result = new DeviceInformation(userAgent, s.os.name, s.device.name, s.browser.name, isMobile);
    return result;
  }
}
