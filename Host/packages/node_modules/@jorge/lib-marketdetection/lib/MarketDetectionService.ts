import {Injectable, Inject} from 'container-ioc';
import { IMarketDetectionService, IMarket, IMarketDetector, MarketSource } from "./interfaces";
import * as e from 'express';
import { TMarketDetector } from './symbols';
import { Market } from './Market'

@Injectable()
export class MarketDetectionService implements IMarketDetectionService
{
    constructor(@Inject(TMarketDetector) private marketDetectors: IMarketDetector[]) {
                
    }
    detectMarket(req: e.Request): IMarket {
        this.marketDetectors.forEach( detector => {
            var market = detector.detectMarketFromRequest(req);
            if (market != undefined)
                return market;
        });

        // TODO: determine default market and provide that


        return new Market("", MarketSource.Unknown);
    }
    
}